
port: 7890
socks-port: 7891
allow-lan: true
mode: Rule
log-level: info
unified-delay: true
ipv6: true

sniffer:
  enable: true
  sniff:
    TLS:
      ports: [443, 8443]
      override-destination: true
    HTTP:
      ports: [80, 8080]
      override-destination: true
    QUIC:
      ports: [443]
  skip-domain:
    - Mijia Cloud
    - dlg.io.mi.com
    - "+.apple.com"
  parse-pure-ip: true
  force-dns-mapping: true

dns:
  enable: true
  ipv6: true
  listen: 0.0.0.0:1053
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/15

  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
    - 1.1.1.1
    - 8.8.8.8
    - 2400:3200::1

  nameserver:
    - "https://dns.adguard-dns.com/dns-query"
    - "https://dns.cloudflare.com/dns-query"

  nameserver-policy:
    "geosite:cn,private,category-ads-all":
      - "https://dns.alidns.com/dns-query"
    "sub.wide.lat": "https://dns.alidns.com/dns-query"

    "dns.alidns.com": [223.5.5.5, 119.29.29.29]
    "dns.adguard-dns.com": [1.1.1.1, 8.8.8.8]
    "dns.cloudflare.com": [1.1.1.1, 8.8.8.8]

  proxy-server-nameserver:
    - 223.5.5.5
    - 119.29.29.29

  fake-ip-filter:
    - "*.lan"
    - "*.localdomain"
    - "*.example"
    - "*.invalid"
    - "*.localhost"
    - "*.test"
    - "*.local"
    - "*.home.arpa"
    - time.*.com
    - time.*.gov
    - time.*.edu.cn
    - time.*.apple.com
    - time1.*.com
    - time2.*.com
    - time3.*.com
    - time4.*.com
    - time5.*.com
    - time6.*.com
    - time7.*.com
    - ntp.*.com
    - ntp1.*.com
    - ntp2.*.com
    - ntp3.*.com
    - ntp4.*.com
    - ntp5.*.com
    - ntp6.*.com
    - ntp7.*.com
    - "*.time.edu.cn"
    - "*.ntp.org.cn"
    - +.pool.ntp.org
    - time1.cloud.tencent.com
    - stun.*.*
    - stun.*.*.*
    - swscan.apple.com
    - mesu.apple.com
    - music.163.com
    - "*.music.163.com"
    - "*.126.net"
    - musicapi.taihe.com
    - music.taihe.com
    - songsearch.kugou.com
    - trackercdn.kugou.com
    - "*.kuwo.cn"
    - api-jooxtt.sanook.com
    - api.joox.com
    - y.qq.com
    - "*.y.qq.com"
    - streamoc.music.tc.qq.com
    - mobileoc.music.tc.qq.com
    - isure.stream.qqmusic.qq.com
    - dl.stream.qqmusic.qq.com
    - aqqmusic.tc.qq.com
    - amobile.music.tc.qq.com
    - localhost.ptlogin2.qq.com
    - "*.msftconnecttest.com"
    - "*.msftncsi.com"
    - "*.xiami.com"
    - "*.music.migu.cn"
    - music.migu.cn
    - +.wotgame.cn
    - +.wggames.cn
    - +.wowsgame.cn
    - +.wargaming.net
    - "*.*.*.srv.nintendo.net"
    - "*.*.stun.playstation.net"
    - xbox.*.*.microsoft.com
    - "*.*.xboxlive.com"
    - "*.ipv6.microsoft.com"
    - teredo.*.*.*
    - teredo.*.*
    - speedtest.cros.wr.pvp.net
    - +.jjvip8.com
    - www.douyu.com
    - activityapi.huya.com
    - activityapi.huya.com.w.cdngslb.com
    - www.bilibili.com
    - api.bilibili.com
    - a.w.bilicdn1.com
    - local.adguard.org
    - localhost.work.weixin.qq.com

proxies:

proxy-groups:
  - name: "拖底分流 (规则需求请私信)"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png
    proxies:
      - "速度优先策略"
      - "DIRECT"

  - name: "速度优先策略"
    type: url-test
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Auto.png
    url: http://www.gstatic.com/generate_204
    interval: 600
    tolerance: 50
    proxies:

  - name: "AI"
    type: select
    icon: https://cdn.jsdelivr.net/gh/Orz-3/mini@master/Color/OpenAI.png
    proxies:
      - "速度优先策略"
      - DIRECT

  - name: "社媒（TikTok，Ins，X，TG等）"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/TikTok.png
    proxies:
      - "速度优先策略"

  - name: "流媒体（YouTube，AppleTV，Netflix等）"
    type: select
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png
    proxies:
      - "速度优先策略"

  - name: "哔哩哔哩(゜-゜)つロ干杯~"
    type: select
    icon: https://cdn.jsdelivr.net/gh/Orz-3/mini@master/Color/Bili.png
    proxies:
      - DIRECT

rule-providers:
  AdvertisingLite:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/AdvertisingLite/AdvertisingLite.yaml"
    path: ./ruleset/AdvertisingLite.yaml
    interval: 86400
  Hijacking:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Hijacking/Hijacking.yaml"
    path: ./ruleset/Hijacking.yaml
    interval: 86400
  OpenAI:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/OpenAI/OpenAI.yaml"
    path: ./ruleset/OpenAI.yaml
    interval: 86400
  Gemini:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Gemini/Gemini.yaml"
    path: ./ruleset/Gemini.yaml
    interval: 86400
  Twitter:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/QuantumultX/Twitter/Twitter.list"
    path: ./ruleset/Twitter.list
    interval: 86400
  Telegram:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/QuantumultX/Telegram/Telegram.list"
    path: ./ruleset/Telegram.list
    interval: 86400
  TikTok:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/TikTok/TikTok.yaml"
    path: ./ruleset/TikTok.yaml
    interval: 86400
  Facebook:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Facebook/Facebook.yaml"
    path: ./ruleset/Facebook.yaml
    interval: 86400
  YouTube:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/YouTube/YouTube.yaml"
    path: ./ruleset/YouTube.yaml
    interval: 86400
  AppleTV:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/AppleTV/AppleTV.yaml"
    path: ./ruleset/AppleTV.yaml
    interval: 86400
  Netflix:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Netflix/Netflix.yaml"
    path: ./ruleset/Netflix.yaml
    interval: 86400
  BiliBili:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/BiliBili/BiliBili.yaml"
    path: ./ruleset/BiliBili.yaml
    interval: 86400
  WeChat:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/WeChat/WeChat.yaml"
    path: ./ruleset/WeChat.yaml
    interval: 86400
  PrivateTracker:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/PrivateTracker/PrivateTracker.yaml"
    path: ./ruleset/PrivateTracker.yaml
    interval: 86400
  cn:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/ChinaMax/ChinaMax_No_Resolve.yaml"
    path: ./ruleset/cn.yaml
    interval: 86400

rules:
  # 1. 拦截与直连
  - RULE-SET,AdvertisingLite,REJECT
  - RULE-SET,Hijacking,REJECT
  - DOMAIN-SUFFIX,woa.com,REJECT
  - RULE-SET,PrivateTracker,DIRECT
  - DOMAIN-SUFFIX,wide.lat,DIRECT

  # 2. AI 服务
  - DOMAIN-SUFFIX,grok.com,AI
  - DOMAIN-SUFFIX,x.ai,AI
  - RULE-SET,OpenAI,AI
  - RULE-SET,Gemini,AI
  - DOMAIN-SUFFIX,cursor.com,AI
  - DOMAIN-SUFFIX,cursor.sh,AI
  - DOMAIN-SUFFIX,cursor.so,AI
  - DOMAIN-SUFFIX,anysphere.co,AI

  # 3. 社交与流媒体
  - RULE-SET,TikTok,社媒（TikTok，Ins，X，TG等）
  - RULE-SET,Facebook,社媒（TikTok，Ins，X，TG等）
  - RULE-SET,Twitter,社媒（TikTok，Ins，X，TG等）
  - RULE-SET,Telegram,社媒（TikTok，Ins，X，TG等）
  - RULE-SET,Netflix,流媒体（YouTube，AppleTV，Netflix等）
  - RULE-SET,YouTube,流媒体（YouTube，AppleTV，Netflix等）
  - RULE-SET,AppleTV,流媒体（YouTube，AppleTV，Netflix等）

  # 4. 特殊服务
  - RULE-SET,BiliBili,哔哩哔哩(゜-゜)つロ干杯~

  # 5. 国内直连 (对应 DNS 中的 nameserver-policy)
  - RULE-SET,cn,DIRECT
  - GEOIP,CN,DIRECT
  - GEOIP,LAN,DIRECT

  # 6. 兜底
  - MATCH,拖底分流 (规则需求请私信)
